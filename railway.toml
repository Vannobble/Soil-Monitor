[deploy]
build.command = "pip install -r requirements.txt"

[build]
builder = "nixpacks"

[[services]]
name = "soil-monitor"
start = "python server.py"
type = "web"
plan = "starter"

[services.env]
PORT = "5000"

# Environment variables untuk real-time
FLASK_ENV = "production"
WEBSOCKET_TIMEOUT = "300"
PING_TIMEOUT = "60"
PING_INTERVAL = "25"

[services.checks]
http.path = "/health"
http.port = 5000
http.interval = 60  # Kurangi frekuensi health check
http.timeout = 5
http.initialDelay = 10

# Tambahkan konfigurasi untuk WebSocket
[services.ports]
port = 5000
protocol = "http"

# Resource allocation untuk real-time
[services.resources]
cpu = 512
memory = 512
